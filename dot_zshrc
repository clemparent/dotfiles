# PATH stuff
export GOPATH=$HOME/go
export GOPRIVATE=github.com/urbn
local brew_path="/opt/homebrew/bin:/opt/homebrew/sbin"
local brew_ruby_path="/opt/homebrew/opt/ruby/bin"
local user_bins="$HOME/bin:$HOME/.local/bin:/usr/local/bin"
local go_bins="$GOROOT/bin:$GOPATH/bin"
export PATH="$brew_ruby_path:$brew_path:$user_bins:$PATH:$go_bins"

# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Theme for ZSH
ZSH_THEME="mortalscumbag"

# ZSH Optimizations
DISABLE_MAGIC_FUNCTIONS="true"
DISABLE_AUTO_UPDATE="true"
DISABLE_COMPFIX="true"
DISABLE_UNTRACKED_FILES_DIRTY="true"


# ZSH Plugins. Use the ZSH NVM plugin over the default NVM because
# It was making shell startup take a long time
zstyle ':omz:plugins:nvm' lazy yes
plugins=(
fzf-tab
nvm
zsh-syntax-highlighting
)

# omz
source $ZSH/oh-my-zsh.sh
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE="20"
ZSH_AUTOSUGGEST_USE_ASYNC=1

# Use helix as the default editor
export VISUAL=hx
export EDITOR="$VISUAL"


# Starship
eval "$(starship init zsh)"

# Optimize completion
autoload -Uz compinit
if [ "$(date +'%j')" != "$(stat -f '%Sm' -t '%j' ~/.zcompdump 2>/dev/null)" ]; then
    compinit
else
    compinit -C
fi


# Yazi
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	if cwd="$(command cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
		builtin cd -- "$cwd"
	fi
	rm -f -- "$tmp"
}

# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/cparent/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/cparent/google-cloud-sdk/path.zsh.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/cparent/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/cparent/google-cloud-sdk/completion.zsh.inc'; fi

# Misc. vars
export DOCKER_HOST="unix://$HOME/.colima/docker.sock"
export GITHUB_SSH_KEY=$(cat ~/.ssh/id_ed25519)

# Start zellij
export ZELLIJ_AUTO_ATTACH=true
if [[ -z "$ZELLIJ" ]] && [[ -z "$SSH_CONNECTION"  ]] && [[ "$TERM_PROGRAM" != "vscode" ]]  ; then
  if [[ "$ZELLIJ_AUTO_ATTACH" == "true" ]]; then
      zellij attach -c
  else
  	eval "$(zellij setup --generate-auto-start zsh)"
  	eval "$(zellij setup --generate-completion zsh)"
  fi

  if [[ "$ZELLIJ_AUTO_EXIT" == "TRUE" ]]; then
      exit
  fi
fi


